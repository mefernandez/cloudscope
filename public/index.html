<html>
	<head>
		<title>CloudScope</title>
    <script type="text/javascript">
      /**
       * This object holds the data upon which the business logic is performed.
       */
      var App = {
        ready: function(name, value) {
          this[name] = value;
          if(this.map && this.csv)
            this.paintMap();
        },
        paintMap: function() {
          console.log('CSV and Map Ready');
        }
      }
    </script>
    <script type="text/javascript">
      /**
       * Client ID and API Key created with Google API Console.
       * @see https://code.google.com/apis/console/
       */
      var clientId = '724831527813';
      var apiKey = 'AIzaSyDUK6nr16VPGVCb3KhQSjW77M40HgN03Tw';
      var scopes = 'https://www.googleapis.com/auth/drive';

      function handleClientLoad() {
        // Step 2: Reference the API key
        gapi.client.setApiKey(apiKey);
        window.setTimeout(checkAuth,1);
      }

      function checkAuth() {
        gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
      }
      
      function handleAuthResult(authResult) {
        // A Google Drive URL that contains a CSV
        var csvURL = 'https://docs.google.com/feeds/download/spreadsheets/Export?key=0AjViUeEB6f2GdG82NFZNMVhweGduanIzVDdZWFU4NXc&exportFormat=csv&gid=0';
        downloadFile(csvURL, csvReady);
      }

    /**
     * Download a file's content.
     *
     * @param {File} file Drive File instance.
     * @param {Function} callback Function to call when the request is complete.
     */
    function downloadFile(downloadUrl, callback) {
        var accessToken = gapi.auth.getToken().access_token;
        var xhr = new XMLHttpRequest();
        xhr.open('GET', downloadUrl);
        xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
        xhr.onload = function() {
          callback(xhr.responseText);
        };
        xhr.onerror = function() {
          callback(null);
        };
        xhr.send();
    }
      
    function csvReady(csvData) {
      console.log(csvData);
      App.ready('csv', csvData);
    }

    </script>
    <script type="text/javascript" src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
    
     <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDUK6nr16VPGVCb3KhQSjW77M40HgN03Tw&sensor=false"></script>
    <script type="text/javascript">
      /**
       * @see https://developers.google.com/maps/documentation/javascript/tutorial
       */
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(-34.397, 150.644),
          zoom: 2
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);
        
        /**
         * @see https://developers.google.com/maps/documentation/javascript/markers
         */
        var myLatlng = new google.maps.LatLng(39.5029182,-0.4423082);
        var marker = new google.maps.Marker({
                      position: myLatlng,
                      title:"Hello World!"
                  });

        // To add the marker to the map, call setMap();
        marker.setMap(map);
        App.ready('map', map);
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    
  </head>
  <body>
    <div id="map-canvas"/>
           
             
  </body>